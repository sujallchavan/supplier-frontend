<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supplier Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <style>
      :root {
        /* Enhanced Deep Purple/Teal theme with richer tones */
        --primary: #7c4dff;
        --primary-light: #b388ff;
        --secondary: #651fff;
        --accent: #00bfa5;
        --accent-light: #64ffda;
        --light: #f5f7ff;
        --dark: #1a237e;
        --dark-light: #534bae;
        --gray: #5f6368;
        --white: #ffffff;
        --card-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        --hover-shadow: 0 12px 40px rgba(124, 77, 255, 0.25);
        --text-gradient: linear-gradient(135deg, var(--primary), var(--accent));
        --success-color: #1cc88a;
        --danger-color: #e74a3b;
        --warning-color: #f6c23e;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", -apple-system, BlinkMacSystemFont, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7ff 0%, #e8eaf6 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Floating shapes background */
      .floating-shapes {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
      }

      .shape {
        position: absolute;
        opacity: 0.08;
        border-radius: 50%;
        filter: blur(20px);
      }

      .shape-1 {
        width: 300px;
        height: 300px;
        background: var(--primary);
        top: -100px;
        left: -100px;
        animation: float 15s infinite ease-in-out;
      }

      .shape-2 {
        width: 200px;
        height: 200px;
        background: var(--accent);
        bottom: -50px;
        right: -50px;
        animation: float 12s infinite ease-in-out reverse;
      }

      .shape-3 {
        width: 150px;
        height: 150px;
        background: var(--secondary);
        top: 40%;
        right: 20%;
        animation: float 10s infinite ease-in-out 2s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) translateX(0);
        }
        50% {
          transform: translateY(-20px) translateX(20px);
        }
      }

      /* Sidebar Styles */
      .sidebar {
        width: 250px;
        background: linear-gradient(
          180deg,
          var(--dark) 10%,
          var(--dark-light) 100%
        );
        color: white;
        min-height: 100vh;
        transition: all 0.3s;
        position: fixed;
        z-index: 1000;
        box-shadow: var(--card-shadow);
      }

      .sidebar-header {
        padding: 1.5rem 1.5rem 0.5rem;
        font-weight: 800;
        font-size: 1.2rem;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        background: var(--text-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .sidebar-menu {
        padding: 0 1rem;
      }

      .nav-item {
        margin: 0.5rem 0;
      }

      .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        border-radius: 0.35rem;
        text-decoration: none;
        transition: all 0.3s;
      }

      .nav-link:hover,
      .nav-link.active {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
      }

      .nav-link i {
        margin-right: 0.5rem;
        font-size: 0.85rem;
      }

      /* Main Content Styles */
      .main-content {
        flex: 1;
        margin-left: 250px;
        transition: all 0.3s;
        min-width: 0;
      }

      /* Topbar Styles */
      .topbar {
        height: 4.375rem;
        box-shadow: var(--card-shadow);
        background-color: var(--white);
        padding: 0 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .topbar h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0;
        white-space: nowrap;
        background: var(--text-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .user-info {
        display: flex;
        align-items: center;
        cursor: pointer;
        position: relative;
        white-space: nowrap;
        transition: all 0.3s;
      }

      .user-info:hover {
        transform: translateY(-2px);
      }

      .user-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
        border: 2px solid var(--primary-light);
      }

      .user-info .user-icon {
        font-size: 1.5rem;
        color: var(--primary);
      }

      .container-fluid {
        padding: 1.5rem;
      }

      /* Card Styles */
      .card {
        border: none;
        border-radius: 0.75rem;
        box-shadow: var(--card-shadow);
        margin-bottom: 1.5rem;
        background-color: var(--white);
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(124, 77, 255, 0.1);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
      }

      .card-header {
        background: var(--text-gradient);
        color: white;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1rem 1.35rem;
        font-weight: 700;
        border-radius: 0.75rem 0.75rem 0 0 !important;
      }

      .card-body {
        padding: 1.5rem;
        overflow-x: auto;
      }

      /* Table Styles */
      .table {
        width: 100%;
        margin-bottom: 1rem;
        color: var(--text-color);
        border-collapse: collapse;
        min-width: 600px;
      }

      .table th {
        background-color: var(--light);
        padding: 0.75rem;
        vertical-align: top;
        border-top: 1px solid #e3e6f0;
        text-align: left;
        font-weight: 700;
        white-space: nowrap;
        color: var(--dark);
      }

      .table td {
        padding: 0.75rem;
        vertical-align: top;
        border-top: 1px solid #e3e6f0;
        white-space: nowrap;
      }

      /* Button Styles */
      .btn {
        display: inline-block;
        font-weight: 600;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        user-select: none;
        border: 1px solid transparent;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        line-height: 1.5;
        border-radius: 50px;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-success {
        color: white;
        background-color: var(--success-color);
        border-color: var(--success-color);
      }

      .btn-success:hover {
        background-color: #17a673;
        border-color: #169b6b;
        transform: translateY(-2px);
        box-shadow: var(--hover-shadow);
      }

      .btn-danger {
        color: white;
        background-color: var(--danger-color);
        border-color: var(--danger-color);
      }

      .btn-danger:hover {
        background-color: #d62c1a;
        border-color: #c52717;
        transform: translateY(-2px);
        box-shadow: var(--hover-shadow);
      }

      .btn-primary {
        color: white;
        background-color: var(--primary);
        border-color: var(--primary);
      }

      .btn-primary:hover {
        background-color: var(--secondary);
        border-color: var(--secondary);
        transform: translateY(-2px);
        box-shadow: var(--hover-shadow);
      }

      .btn-logout {
        color: white;
        background-color: var(--danger-color);
        border-color: var(--danger-color);
        padding: 0.5rem 1rem;
        width: 100%;
        text-align: left;
      }

      /* Supplier Info Styles */
      .supplier-info {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .info-item {
        background-color: var(--white);
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        border: 1px solid rgba(124, 77, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .info-item:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
      }

      .info-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--text-gradient);
        transition: width 0.3s ease;
      }

      .info-item:hover::before {
        width: 6px;
      }

      .info-item h3 {
        font-size: 1rem;
        color: var(--gray);
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      .info-item p {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        margin: 0;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: var(--white);
        border-radius: 0.75rem;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        box-shadow: var(--hover-shadow);
        overflow: hidden;
        animation: fadeInUp 0.3s;
        display: flex;
        flex-direction: column;
        border: 1px solid rgba(124, 77, 255, 0.2);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        background: var(--text-gradient);
        color: white;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h3 {
        margin: 0;
        font-size: 1.25rem;
      }

      .modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
      }

      .modal-close:hover {
        transform: rotate(90deg);
      }

      .modal-body {
        padding: 1.5rem;
        overflow-y: auto;
        flex: 1;
      }

      .modal-footer {
        padding: 1rem 1.5rem;
        background-color: var(--light);
        border-top: 1px solid rgba(124, 77, 255, 0.1);
        display: flex;
        justify-content: flex-end;
      }

      /* Order Details Modal Styles */
      .order-details {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .detail-group {
        margin-bottom: 1rem;
        padding: 1rem;
        background-color: var(--light);
        border-radius: 0.5rem;
        border: 1px solid rgba(124, 77, 255, 0.1);
      }

      .detail-group h4 {
        margin-bottom: 0.5rem;
        color: var(--primary);
        font-size: 1rem;
        display: flex;
        align-items: center;
      }

      .detail-group h4 i {
        margin-right: 8px;
        color: var(--accent);
      }

      .detail-group p {
        margin: 0.25rem 0;
        color: var(--gray);
      }

      /* Status Badges */
      .badge {
        display: inline-block;
        padding: 0.35em 0.65em;
        font-size: 0.75em;
        font-weight: 700;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 50px;
      }

      .badge-primary {
        color: #fff;
        background-color: var(--primary);
      }

      .badge-success {
        color: #fff;
        background-color: var(--success-color);
      }

      .badge-danger {
        color: #fff;
        background-color: var(--danger-color);
      }

      .badge-warning {
        color: #1f2d3d;
        background-color: var(--warning-color);
      }

      /* No Data Message */
      .no-data {
        text-align: center;
        padding: 2rem;
        color: var(--gray);
        font-style: italic;
      }

      /* Customer Details Modal Styles */
      .customer-details {
        padding: 0 10px;
      }

      .customer-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(124, 77, 255, 0.1);
      }

      .customer-avatar {
        width: 60px;
        height: 60px;
        background: var(--text-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
      }

      .customer-avatar i {
        font-size: 30px;
        color: white;
      }

      .customer-info h3 {
        margin: 0;
        color: var(--primary);
        font-size: 1.5rem;
      }

      .customer-info p {
        margin: 5px 0 0;
        color: var(--gray);
      }

      .detail-section {
        margin-bottom: 25px;
      }

      .detail-section h4 {
        color: var(--primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
      }

      .detail-section h4 i {
        margin-right: 8px;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
      }

      .detail-item {
        background: var(--light);
        padding: 12px;
        border-radius: 0.5rem;
        border: 1px solid rgba(124, 77, 255, 0.1);
      }

      .detail-label {
        display: block;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 5px;
        font-size: 0.85rem;
      }

      .detail-value {
        color: var(--gray);
        font-size: 1rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }

      .stat-item {
        background: var(--light);
        padding: 15px;
        border-radius: 0.5rem;
        text-align: center;
        border: 1px solid rgba(124, 77, 255, 0.1);
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
      }

      .stat-label {
        color: var(--gray);
        font-size: 0.85rem;
      }

      .activity-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
      }

      .activity-list li {
        padding: 8px 0;
        border-bottom: 1px solid rgba(124, 77, 255, 0.1);
        color: var(--gray);
      }

      .activity-list li:last-child {
        border-bottom: none;
      }

      .btn-view {
        padding: 5px 10px;
        font-size: 0.8rem;
      }

      /* Responsive Styles */
      @media (max-width: 992px) {
        .sidebar {
          margin-left: -250px;
        }

        .main-content {
          margin-left: 0;
        }

        .sidebar.active {
          margin-left: 0;
        }

        .main-content.active {
          margin-left: 250px;
        }

        .topbar h1 {
          font-size: 1.2rem;
        }
      }

      @media (max-width: 768px) {
        .supplier-info {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
        }

        .order-details {
          grid-template-columns: 1fr;
        }

        .card-body {
          padding: 1rem;
        }

        .container-fluid {
          padding: 1rem;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Toggle Button for Mobile */
      .sidebar-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--primary);
        cursor: pointer;
        margin-right: 1rem;
        transition: all 0.3s;
      }

      .sidebar-toggle:hover {
        color: var(--secondary);
        transform: rotate(90deg);
      }

      @media (max-width: 992px) {
        .sidebar-toggle {
          display: block;
        }
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--light);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary);
      }

      /* Animation classes */
      .animate-delay-1 {
        animation-delay: 0.1s;
      }
      .animate-delay-2 {
        animation-delay: 0.2s;
      }
      .animate-delay-3 {
        animation-delay: 0.3s;
      }
    </style>
  </head>
  <body>
    <!-- Floating background shapes -->
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header animate__animated animate__fadeInDown">
        <span>Supplier Portal</span>
      </div>
      <div class="sidebar-menu">
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-1"
        >
          <a href="#" class="nav-link active">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-2"
        >
          <a href="order.html" class="nav-link">
            <i class="fas fa-fw fa-clipboard-list"></i>
            <span>Orders</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-3"
        >
          <a href="#" class="nav-link">
            <i class="fas fa-fw fa-check-circle"></i>
            <span>Accepted Orders</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-1"
        >
          <a href="#" class="nav-link">
            <i class="fas fa-fw fa-times-circle"></i>
            <span>Rejected Orders</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-2"
        >
          <a href="#" class="nav-link">
            <i class="fas fa-fw fa-user-check"></i>
            <span>Assigned Orders</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-3"
        >
          <a href="#" class="nav-link">
            <i class="fas fa-fw fa-cog"></i>
            <span>Settings</span>
          </a>
        </div>
        <div
          class="nav-item animate__animated animate__fadeInLeft animate-delay-1"
        >
          <button
            id="logout"
            class="nav-link btn-logout"
            style="width: 100%; text-align: left"
          >
            <i class="fas fa-fw fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="main-content">
      <!-- Topbar -->
      <nav class="topbar">
        <button class="sidebar-toggle" id="sidebarToggle">
          <i class="fas fa-bars"></i>
        </button>
        <h1 class="animate__animated animate__fadeIn">Supplier Dashboard</h1>
        <div class="user-info" id="userInfoTop">
          <span>Loading...</span>
        </div>
      </nav>

      <!-- Page Content -->
      <div class="container-fluid">
        <!-- Supplier Information -->
        <div class="card mb-4 animate__animated animate__fadeInUp">
          <div class="card-header">
            <h2>Supplier Information</h2>
          </div>
          <div class="card-body">
            <div class="supplier-info" id="supplierInfo">
              <!-- Dynamically filled by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Order Statistics -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-1"
        >
          <div class="card-header">
            <h2>Order Statistics</h2>
          </div>
          <div class="card-body">
            <div class="supplier-info" id="orderStats">
              <!-- Will be filled dynamically -->
            </div>
          </div>
        </div>

        <!-- Customer Orders -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-2"
        >
          <div class="card-header">
            <h2>Customer Orders</h2>
          </div>
          <div class="card-body">
            <div id="orders">
              <p>Fetching orders...</p>
            </div>
          </div>
        </div>

        <!-- Customers Working With You -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-1"
        >
          <div class="card-header">
            <h2>Customers Working With You</h2>
          </div>
          <div class="card-body">
            <div id="customersWorking">
              <p>Fetching customer details...</p>
            </div>
          </div>
        </div>

        <!-- Assigned Orders -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-2"
        >
          <div class="card-header">
            <h2>Orders Assigned to You</h2>
          </div>
          <div class="card-body">
            <div id="assignedOrders">
              <p>Fetching assigned orders...</p>
            </div>
          </div>
        </div>

        <!-- Accepted Orders -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-3"
        >
          <div class="card-header">
            <h2>Accepted Orders</h2>
          </div>
          <div class="card-body">
            <div id="acceptedOrders">
              <p>Fetching accepted orders...</p>
            </div>
          </div>
        </div>

        <!-- Rejected Orders -->
        <div
          class="card mb-4 animate__animated animate__fadeInUp animate-delay-1"
        >
          <div class="card-header">
            <h2>Rejected Orders</h2>
          </div>
          <div class="card-body">
            <div id="rejectedOrders">
              <p>Fetching rejected orders...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Profile Modal -->
    <div class="modal" id="userModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Supplier Profile</h3>
          <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Dynamically filled by JavaScript -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-logout" id="modalLogout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Order Details Modal -->
    <div class="modal" id="orderModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Order Details</h3>
          <button class="modal-close" id="orderModalClose">&times;</button>
        </div>
        <div class="modal-body" id="orderModalBody">
          <!-- Dynamically filled by JavaScript -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="closeOrderModal">Close</button>
        </div>
      </div>
    </div>

    <script>
      // Toggle sidebar on mobile
      document
        .getElementById("sidebarToggle")
        .addEventListener("click", function () {
          document.getElementById("sidebar").classList.toggle("active");
          document.getElementById("main-content").classList.toggle("active");
        });

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (event) {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("main-content");
        const toggleBtn = document.getElementById("sidebarToggle");

        if (
          window.innerWidth <= 992 &&
          !sidebar.contains(event.target) &&
          !toggleBtn.contains(event.target) &&
          sidebar.classList.contains("active")
        ) {
          sidebar.classList.remove("active");
          mainContent.classList.remove("active");
        }
      });

      // Modal functionality
      const userModal = document.getElementById("userModal");
      const modalClose = document.getElementById("modalClose");
      const modalLogout = document.getElementById("modalLogout");

      const orderModal = document.getElementById("orderModal");
      const orderModalClose = document.getElementById("orderModalClose");
      const closeOrderModal = document.getElementById("closeOrderModal");

      // Open modal when clicking user info
      document
        .getElementById("userInfoTop")
        .addEventListener("click", function () {
          userModal.style.display = "flex";
          document.body.style.overflow = "hidden"; // Prevent scrolling when modal is open
        });

      // Close modal when clicking close button
      modalClose.addEventListener("click", function () {
        userModal.style.display = "none";
        document.body.style.overflow = "auto";
      });

      // Close order modal when clicking close button
      orderModalClose.addEventListener("click", function () {
        orderModal.style.display = "none";
        document.body.style.overflow = "auto";
      });

      closeOrderModal.addEventListener("click", function () {
        orderModal.style.display = "none";
        document.body.style.overflow = "auto";
      });

      // Close modal when clicking outside
      userModal.addEventListener("click", function (e) {
        if (e.target === userModal) {
          userModal.style.display = "none";
          document.body.style.overflow = "auto";
        }
      });

      // Close order modal when clicking outside
      orderModal.addEventListener("click", function (e) {
        if (e.target === orderModal) {
          orderModal.style.display = "none";
          document.body.style.overflow = "auto";
        }
      });

      // Logout from modal
      modalLogout.addEventListener("click", function () {
        sessionStorage.clear();
        window.location.href = "login.html";
      });

      const supplierData = sessionStorage.getItem("supplier");

      if (supplierData) {
        const supplier = JSON.parse(supplierData);

        // Update top user info
        document.getElementById("userInfoTop").innerHTML = `
                <i class="fas fa-user-circle user-icon"></i>
                <span>${supplier.name}</span>
              `;

        // Update modal content
        document.getElementById("modalBody").innerHTML = `
                <div class="modal-profile">
                  <div class="modal-profile-img">
                    <i class="fas fa-user-tie"></i>
                  </div>
                  <div class="modal-profile-info">
                    <h4>${supplier.name}</h4>
                    <p>${supplier.companyName || "No Company"}</p>
                    <p>${supplier.category || "No Category"}</p>
                  </div>
                </div>
                <div class="modal-details">
                  <div class="modal-detail-item">
                    <h5>Supplier ID</h5>
                    <p>${supplier.supplierId}</p>
                  </div>
                  <div class="modal-detail-item">
                    <h5>Email</h5>
                    <p>${supplier.email}</p>
                  </div>
                  <div class="modal-detail-item">
                    <h5>Phone</h5>
                    <p>${supplier.phoneNumber || "N/A"}</p>
                  </div>
                  <div class="modal-detail-item">
                    <h5>Location</h5>
                    <p>${supplier.location || "N/A"}</p>
                  </div>
                </div>
              `;

        // Update supplier info cards
        document.getElementById("supplierInfo").innerHTML = `
                <div class="info-item">
                  <h3>Supplier ID</h3>
                  <p>${supplier.supplierId}</p>
                </div>
                <div class="info-item">
                  <h3>Name</h3>
                  <p>${supplier.name}</p>
                </div>
                <div class="info-item">
                  <h3>Email</h3>
                  <p>${supplier.email}</p>
                </div>
                <div class="info-item">
                  <h3>Phone</h3>
                  <p>${supplier.phoneNumber || "N/A"}</p>
                </div>
                <div class="info-item">
                  <h3>Company</h3>
                  <p>${supplier.companyName || "N/A"}</p>
                </div>
                <div class="info-item">
                  <h3>Category</h3>
                  <p>${supplier.category || "N/A"}</p>
                </div>
                <div class="info-item">
                  <h3>Address</h3>
                  <p>${supplier.location || "N/A"}</p>
                </div>
              `;

        fetchOrders(supplier);
      } else {
        document.getElementById("supplierInfo").innerHTML = `
                <div class="info-item" style="grid-column: 1 / -1;">
                  <h3>Error</h3>
                  <p>Not logged in!</p>
                </div>
              `;
        window.location.href = "login.html";
      }

      function fetchOrders(supplier) {
        fetch(
          `https://backend-api-hu8l.onrender.com/api/suppliers/orders?category=${supplier.category}`
        )
          .then((response) => response.json())
          .then((orders) => {
            const ordersContainer = document.getElementById("orders");
            ordersContainer.innerHTML = "";

            // Filter only orders that are approved
            let approvedOrders = orders.filter(
              (order) => order.isApproved === "Approved"
            );

            // Exclude orders that are already accepted or rejected
            let pendingOrders = approvedOrders.filter(
              (order) =>
                !order.supplierResponses ||
                !order.supplierResponses.some(
                  (response) =>
                    response.supplier_Id === supplier.supplierId &&
                    (response.status === "Accepted" ||
                      response.status === "Rejected")
                )
            );

            if (pendingOrders.length === 0) {
              ordersContainer.innerHTML =
                '<div class="no-data">No pending orders available.</div>';
              fetchAssignedOrders(supplier, orders);
              fetchAcceptedOrders(supplier, approvedOrders);
              fetchRejectedOrders(supplier, approvedOrders);
              return;
            }

            const table = document.createElement("table");
            table.className = "table";
            table.innerHTML = `
                      <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Part</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Description</th>
                            <th>Quantity</th>
                                                    <th>Price</th>
                        <th>Approval Status</th>
                        <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                  </tbody>
              `;

            const tbody = document.createElement("tbody");
            pendingOrders.forEach((order) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                      <td>${order.order_id}</td>
                      <td>${order.cname} (${order.email})</td>
                      <td>${order.Part_Name}</td>
                      <td>${order.category}</td>
                      <td><span class="badge ${
                        order.working_status === "Completed"
                          ? "badge-success"
                          : order.working_status === "Working"
                          ? "badge-primary"
                          : "badge-warning"
                      }">${order.working_status}</span></td>
                      <td>${order.desc}</td>
                      <td>${order.tv}</td>
                      <td>${order.pr}</td>
                      <td><span class="badge ${
                        order.isApproved === "Approved"
                          ? "badge-success"
                          : "badge-danger"
                      }">${order.isApproved}</span></td>
                      <td>
                          <button class="btn btn-success" onclick="updateOrderStatus('${
                            order.order_id
                          }', '${
                supplier.supplierId
              }', 'Accepted')">Accept</button>
                          <button class="btn btn-danger" onclick="updateOrderStatus('${
                            order.order_id
                          }', '${
                supplier.supplierId
              }', 'Rejected')">Reject</button>
                      </td>
                  `;
              tbody.appendChild(row);
            });

            table.appendChild(tbody);
            ordersContainer.appendChild(table);
            fetchAssignedOrders(supplier, orders);
            fetchAcceptedOrders(supplier, approvedOrders);
            fetchRejectedOrders(supplier, approvedOrders);
            // Inside your fetchOrders function, after processing orders:
            displayOrderStats(orders, supplier);
            // Call the new function to fetch customers working with this supplier
            fetchCustomersWorkingWithSupplier(supplier);
          })
          .catch((error) => {
            console.error("Error fetching orders:", error);
            document.getElementById("orders").innerHTML =
              '<div class="no-data">Failed to fetch orders. Please try again later.</div>';
          });
      }

      async function fetchCustomersWorkingWithSupplier(supplier) {
        try {
          // First get all assigned orders to this supplier
          const ordersResponse = await fetch(
            `https://backend-api-hu8l.onrender.com/api/suppliers/orders?category=${supplier.category}`
          );

          // Check if orders response is JSON
          const ordersContentType = ordersResponse.headers.get("content-type");
          if (
            !ordersContentType ||
            !ordersContentType.includes("application/json")
          ) {
            const text = await ordersResponse.text();
            throw new Error(
              `Orders API returned non-JSON: ${text.substring(0, 100)}...`
            );
          }

          const orders = await ordersResponse.json();

          // Filter orders assigned to this supplier
          const assignedOrders = orders.filter(
            (order) =>
              order.isSupplierAccepted &&
              order.acceptedSupplier?.supplier_Id === supplier.supplierId
          );

          // Get unique customer emails from these orders
          const customerEmails = [
            ...new Set(assignedOrders.map((order) => order.email)),
          ];

          if (customerEmails.length === 0) {
            document.getElementById("customersWorking").innerHTML =
              '<div class="no-data">No customers found who are working with you.</div>';
            return;
          }

          // Fetch customer details
          const customersResponse = await fetch(
            "https://backend-api-hu8l.onrender.com/api/suppliers/customers",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ emails: customerEmails }),
            }
          );

          // Check if customers response is JSON
          const customersContentType =
            customersResponse.headers.get("content-type");
          if (
            !customersContentType ||
            !customersContentType.includes("application/json")
          ) {
            const text = await customersResponse.text();
            throw new Error(
              `Customers API returned non-JSON: ${text.substring(0, 100)}...`
            );
          }

          const result = await customersResponse.json();

          if (!result.success || !result.data) {
            throw new Error(
              result.message || "Failed to fetch customer details"
            );
          }

          const customers = result.data;
          const customersContainer =
            document.getElementById("customersWorking");
          customersContainer.innerHTML = "";

          if (!customers || customers.length === 0) {
            customersContainer.innerHTML =
              '<div class="no-data">No customer details found.</div>';
            return;
          }

          const table = document.createElement("table");
          table.className = "table";
          table.innerHTML = `
  <thead>
    <tr>
      <th>Customer ID</th>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Location</th>
      <th>Orders Count</th>
      <th>View Details</th>
    </tr>
  </thead>
  <tbody id="customersTableBody"></tbody>
`;

          const tbody = document.createElement("tbody");
          customers.forEach((customer) => {
            const orderCount = assignedOrders.filter(
              (order) => order.email === customer.email
            ).length;

            const row = document.createElement("tr");
            row.innerHTML = `<td>${customer.customer_id || "N/A"}</td> <td>${
              customer.name || "N/A"
            }</td> <td>${customer.email || "N/A"}</td> <td>${
              customer.phone_number || "N/A"
            }</td> <td>${
              customer.location || "N/A"
            }</td> <td>${orderCount}</td> <td> <button class="btn btn-primary btn-view" onclick="viewCustomerDetails('${
              customer.customer_id
            }')" data-customer='${JSON.stringify(customer).replace(
              /'/g,
              "\\'"
            )}' data-orders='${orderCount}'> <i class="fas fa-eye"></i> View </button> </td> `;
            tbody.appendChild(row);
          });
          table.appendChild(tbody);
          customersContainer.appendChild(table);
        } catch (error) {
          console.error("Error fetching customers:", error);
          document.getElementById("customersWorking").innerHTML = `
  <div class="no-data">Error: ${error.message}</div>
`;
        }
      }

      // View Customer Details Modal
      function viewCustomerDetails(customerId) {
        const button = document.querySelector(
          `button[onclick="viewCustomerDetails('${customerId}')"]`
        );
        const customer = JSON.parse(button.getAttribute("data-customer"));
        const orderCount = button.getAttribute("data-orders");

        // Create modal content
        const modalContent = `
<div class="customer-details">
  <div class="customer-header">
    <div class="customer-avatar">
      <i class="fas fa-user-tie"></i>
    </div>
    <div class="customer-info">
      <h3>${customer.name || "No Name"}</h3>
      <p>Customer ID: ${customer.customer_id}</p>
    </div>
  </div>
  
  <div class="detail-section">
    <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
    <div class="detail-grid">
      <div class="detail-item">
        <span class="detail-label">Email:</span>
        <span class="detail-value">${customer.email || "N/A"}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Phone:</span>
        <span class="detail-value">${customer.phone_number || "N/A"}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Location:</span>
        <span class="detail-value">${customer.location || "N/A"}</span>
      </div>
    </div>
  </div>
  
  <div class="detail-section">
    <h4><i class="fas fa-shopping-cart"></i> Order Statistics</h4>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">${orderCount}</div>
        <div class="stat-label">Total Orders</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${Math.floor(Math.random() * 10) + 1}</div>
        <div class="stat-label">Active Orders</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${Math.floor(Math.random() * 1000) + 100}</div>
        <div class="stat-label">Total Spent ($)</div>
      </div>
    </div>
  </div>
  
  <div class="detail-section">
    <h4><i class="fas fa-history"></i> Recent Activity</h4>
    <ul class="activity-list">
      <li>Placed order #${Math.floor(
        Math.random() * 1000
      )} on ${new Date().toLocaleDateString()}</li>
      <li>Updated profile information</li>
      <li>Contacted support</li>
    </ul>
  </div>
</div>`; // Set modal content and show
        document.getElementById("orderModalBody").innerHTML = modalContent;
        document.getElementById("orderModal").style.display = "flex";
        document.body.style.overflow = "hidden";

        // Update modal title
        document.querySelector("#orderModal .modal-header h3").textContent =
          "Customer Details";
      }

      function fetchAssignedOrders(supplier, orders) {
        const assignedOrders = orders.filter(
          (order) =>
            order.isSupplierAccepted &&
            order.acceptedSupplier?.supplier_Id === supplier.supplierId
        );

        const assignedOrdersContainer =
          document.getElementById("assignedOrders");
        assignedOrdersContainer.innerHTML = "";

        if (assignedOrders.length === 0) {
          assignedOrdersContainer.innerHTML =
            '<div class="no-data">No orders assigned to you yet.</div>';
          return;
        }

        const table = document.createElement("table");
        table.className = "table";
        table.innerHTML = `
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Part</th>
            <th>Category</th>
            <th>Status</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Assigned Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="assignedOrdersTableBody">
        </tbody>
      `;

        const tbody = document.createElement("tbody");
        assignedOrders.forEach((order) => {
          const row = document.createElement("tr");
          row.innerHTML = `
          <td>${order.order_id}</td>
          <td>${order.cname} (${order.email})</td>
          <td>${order.Part_Name}</td>
          <td>${order.category}</td>
          <td><span class="badge ${
            order.working_status === "Completed"
              ? "badge-success"
              : order.working_status === "Working"
              ? "badge-primary"
              : "badge-warning"
          }">${order.working_status}</span></td>
          <td>${order.desc}</td>
          <td>${order.tv}</td>
          <td>${order.pr}</td>
          <td>${
            order.acceptedSupplier?.acceptedAt
              ? new Date(order.acceptedSupplier.acceptedAt).toLocaleString()
              : "N/A"
          }</td>
          <td>
            <button class="btn btn-primary" onclick="viewOrderDetails('${
              order.order_id
            }')">View</button>
          </td>
        `;
          tbody.appendChild(row);
        });

        table.appendChild(tbody);
        assignedOrdersContainer.appendChild(table);
      }

      function fetchAcceptedOrders(supplier, orders) {
        const acceptedOrders = orders.filter(
          (order) =>
            order.supplierResponses &&
            order.supplierResponses.some(
              (response) =>
                response.supplier_Id === supplier.supplierId &&
                response.status === "Accepted"
            )
        );

        const acceptedOrdersContainer =
          document.getElementById("acceptedOrders");
        acceptedOrdersContainer.innerHTML = "";

        if (acceptedOrders.length === 0) {
          acceptedOrdersContainer.innerHTML =
            '<div class="no-data">No accepted orders found.</div>';
          return;
        }

        const table = document.createElement("table");
        table.className = "table";
        table.innerHTML = `
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Part</th>
          <th>Category</th>
          <th>Status</th>
          <th>Description</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Supplier ID</th>
          <th>Supplier Responses</th>
          <th>Assignment</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="acceptedOrdersTableBody">
      </tbody>
    `;

        const tbody = document.createElement("tbody");
        acceptedOrders.forEach((order) => {
          const supplierResponse = order.supplierResponses.find(
            (response) => response.supplier_Id === supplier.supplierId
          );

          const isAssignedToCurrentSupplier =
            order.acceptedSupplier &&
            order.acceptedSupplier.supplier_Id === supplier.supplierId;

          const assignmentStatus = isAssignedToCurrentSupplier
            ? `<span class="badge badge-success">Assigned to You</span>`
            : `<span class="badge badge-warning">Assigned to Someone Else</span>`;

          const row = document.createElement("tr");
          row.innerHTML = `
        <td>${order.order_id}</td>
        <td>${order.cname} (${order.email})</td>
        <td>${order.Part_Name}</td>
        <td>${order.category}</td>
        <td><span class="badge ${
          order.working_status === "Completed"
            ? "badge-success"
            : order.working_status === "Working"
            ? "badge-primary"
            : "badge-warning"
        }">${order.working_status}</span></td>
        <td>${order.desc}</td>
        <td>${order.tv}</td>
        <td>${order.pr}</td>
        <td>${supplierResponse.supplier_Id}</td>
        <td><span class="badge badge-success">${
          supplierResponse.status
        }</span></td>
        <td>${assignmentStatus}</td>
        <td>
          <button class="btn btn-primary" onclick="viewAcceptedOrderDetails('${
            order.order_id
          }')">View</button>
        </td>
      `;
          tbody.appendChild(row);
        });

        table.appendChild(tbody);
        acceptedOrdersContainer.appendChild(table);
      }

      function fetchRejectedOrders(supplier, orders) {
        const rejectedOrders = orders.filter(
          (order) =>
            order.supplierResponses &&
            order.supplierResponses.some(
              (response) =>
                response.supplier_Id === supplier.supplierId &&
                response.status === "Rejected"
            )
        );

        const rejectedOrdersContainer =
          document.getElementById("rejectedOrders");
        rejectedOrdersContainer.innerHTML = "";

        if (rejectedOrders.length === 0) {
          rejectedOrdersContainer.innerHTML =
            '<div class="no-data">No rejected orders found.</div>';
          return;
        }

        const table = document.createElement("table");
        table.className = "table";
        table.innerHTML = `
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Part</th>
                <th>Category</th>
                <th>Status</th>
                <th>Description</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Supplier ID</th>
                <th>Supplier Responses</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="rejectedOrdersTableBody">
            </tbody>
          `;

        const tbody = document.createElement("tbody");
        rejectedOrders.forEach((order) => {
          const supplierResponse = order.supplierResponses.find(
            (response) => response.supplier_Id === supplier.supplierId
          );

          const row = document.createElement("tr");
          row.innerHTML = `
              <td>${order.order_id}</td>
              <td>${order.cname} (${order.email})</td>
              <td>${order.Part_Name}</td>
              <td>${order.category}</td>
              <td><span class="badge ${
                order.working_status === "Completed"
                  ? "badge-success"
                  : order.working_status === "Working"
                  ? "badge-primary"
                  : "badge-warning"
              }">${order.working_status}</span></td>
              <td>${order.desc}</td>
              <td>${order.tv}</td>
              <td>${order.pr}</td>
              <td>${supplierResponse.supplier_Id}</td>
              <td><span class="badge badge-danger">${
                supplierResponse.status
              }</span></td>
              <td>
      <button class="btn btn-primary" onclick="viewRejectedOrderDetails('${
        order.order_id
      }')">View</button>
            `;
          tbody.appendChild(row);
        });

        table.appendChild(tbody);
        rejectedOrdersContainer.appendChild(table);
      }

      function viewOrderDetails(orderId) {
        const supplierData = sessionStorage.getItem("supplier");
        if (!supplierData) {
          alert("Supplier data not found. Please login again.");
          return;
        }

        const supplier = JSON.parse(supplierData);

        // Find the order in assigned orders
        const assignedOrdersContainer =
          document.getElementById("assignedOrders");
        const rows = assignedOrdersContainer.querySelectorAll("tbody tr");

        let order = null;
        for (const row of rows) {
          const rowOrderId = row.cells[0].textContent;
          if (rowOrderId === orderId) {
            order = {
              order_id: rowOrderId,
              cname: row.cells[1].textContent.split(" (")[0],
              email: row.cells[1].textContent.match(/\((.*?)\)/)[1],
              Part_Name: row.cells[2].textContent,
              category: row.cells[3].textContent,
              working_status: row.cells[4].querySelector(".badge").textContent,
              desc: row.cells[5].textContent,
              tv: row.cells[6].textContent,
              pr: row.cells[7].textContent,
              isApproved: "Approved", // Since it's assigned, it must be approved
              acceptedSupplier: {
                supplier_Id: supplier.supplierId,
                acceptedAt: row.cells[8].textContent,
              },
            };
            break;
          }
        }

        if (!order) {
          document.getElementById("orderModalBody").innerHTML = `
          <div class="no-data">Order details not found in assigned orders.</div>
      `;
        } else {
          // Populate the modal with order details
          document.getElementById("orderModalBody").innerHTML = `
          <div class="order-details">
              <div class="detail-group">
                  <h4><i class="fas fa-info-circle"></i> Order Information</h4>
                  <p><strong>Order ID:</strong> ${order.order_id}</p>
                  <p><strong>Status:</strong> <span class="badge ${
                    order.working_status === "Completed"
                      ? "badge-success"
                      : order.working_status === "Working"
                      ? "badge-primary"
                      : "badge-warning"
                  }">${order.working_status}</span></p>
                  <p><strong>Approval Status:</strong> <span class="badge badge-success">${
                    order.isApproved
                  }</span></p>
              </div>
              
              <div class="detail-group">
                  <h4><i class="fas fa-cog"></i> Part Details</h4>
                  <p><strong>Part Name:</strong> ${order.Part_Name}</p>
                  <p><strong>Category:</strong> ${order.category}</p>
                  <p><strong>Description:</strong> ${order.desc}</p>
                  <p><strong>Quantity:</strong> ${order.tv}</p>
                  <p><strong>Price:</strong> ${order.pr}</p>
              </div>
              
              <div class="detail-group">
                  <h4><i class="fas fa-user"></i> Customer Information</h4>
                  <p><strong>Name:</strong> ${order.cname}</p>
                  <p><strong>Email:</strong> ${order.email}</p>
              </div>
              
              <div class="detail-group">
                  <h4><i class="fas fa-user-tie"></i> Supplier Assignment</h4>
                  <p><strong>Supplier ID:</strong> ${
                    order.acceptedSupplier.supplier_Id
                  }</p>
                  <p><strong>Assigned At:</strong> ${
                    order.acceptedSupplier.acceptedAt
                  }</p>
              </div>
          </div>
      `;
        }

        // Show the modal
        orderModal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function viewAcceptedOrderDetails(orderId) {
        const supplierData = sessionStorage.getItem("supplier");
        if (!supplierData) {
          alert("Supplier data not found. Please login again.");
          return;
        }

        const supplier = JSON.parse(supplierData);
        const acceptedOrdersContainer =
          document.getElementById("acceptedOrders");
        const rows = acceptedOrdersContainer.querySelectorAll("tbody tr");

        for (const row of rows) {
          const rowOrderId = row.cells[0].textContent;
          if (rowOrderId === orderId) {
            const responseSupplierId = row.cells[8].textContent;
            const acceptedSupplierId =
              row.cells.length > 10 ? row.cells[10].textContent : null;

            const isCurrentSupplier =
              responseSupplierId === supplier.supplierId.toString();

            const isAssignedToSomeoneElse =
              acceptedSupplierId &&
              acceptedSupplierId.toString() !== supplier.supplierId.toString();

            const isAssignedToCurrentSupplier =
              acceptedSupplierId &&
              acceptedSupplierId.toString() === supplier.supplierId.toString();

            const order = {
              order_id: rowOrderId,
              cname: row.cells[1].textContent.split(" (")[0],
              email: row.cells[1].textContent.match(/\((.*?)\)/)[1],
              Part_Name: row.cells[2].textContent,
              category: row.cells[3].textContent,
              working_status: row.cells[4].querySelector(".badge").textContent,
              desc: row.cells[5].textContent,
              tv: row.cells[6].textContent,
              pr: row.cells[7].textContent,
              isApproved: "Approved",
              isCurrentSupplier,
              isAssignedToSomeoneElse,
              isAssignedToCurrentSupplier,
              acceptedSupplierId,
            };

            showOrderModal(order, "accepted");
            return;
          }
        }

        showNotFoundMessage("accepted");
      }

      function viewRejectedOrderDetails(orderId) {
        const supplierData = sessionStorage.getItem("supplier");
        if (!supplierData) {
          alert("Supplier data not found. Please login again.");
          return;
        }

        const supplier = JSON.parse(supplierData);
        const rejectedOrdersContainer =
          document.getElementById("rejectedOrders");
        const rows = rejectedOrdersContainer.querySelectorAll("tbody tr");

        for (const row of rows) {
          const rowOrderId = row.cells[0].textContent;
          if (rowOrderId === orderId) {
            const responseSupplierId = row.cells[8].textContent;
            const acceptedSupplierId =
              row.cells.length > 10 ? row.cells[10].textContent : null;

            const isCurrentSupplier =
              responseSupplierId === supplier.supplierId.toString();

            const isAssignedToSomeoneElse =
              acceptedSupplierId &&
              acceptedSupplierId.toString() !== supplier.supplierId.toString();

            const isAssignedToCurrentSupplier =
              acceptedSupplierId &&
              acceptedSupplierId.toString() === supplier.supplierId.toString();

            const order = {
              order_id: rowOrderId,
              cname: row.cells[1].textContent.split(" (")[0],
              email: row.cells[1].textContent.match(/\((.*?)\)/)[1],
              Part_Name: row.cells[2].textContent,
              category: row.cells[3].textContent,
              working_status: row.cells[4].querySelector(".badge").textContent,
              desc: row.cells[5].textContent,
              tv: row.cells[6].textContent,
              pr: row.cells[7].textContent,
              isApproved: "Approved",
              isCurrentSupplier,
              isAssignedToSomeoneElse,
              isAssignedToCurrentSupplier,
              acceptedSupplierId,
            };

            showOrderModal(order, "rejected");
            return;
          }
        }

        showNotFoundMessage("rejected");
      }

      function showOrderModal(order, type) {
        let assignmentStatusHtml = "";

        if (type === "accepted") {
          assignmentStatusHtml = order.isAssignedToCurrentSupplier
            ? `<div class="detail-group">
        <h4><i class="fas fa-check-circle"></i> Assignment Status</h4>
        <p class="text-success"><i class="fas fa-check-circle"></i> This order is assigned to you</p>
    </div>`
            : `<div class="detail-group">
        <h4><i class="fas fa-exclamation-triangle"></i> Assignment Status</h4>
        <p class="text-warning"><i class="fas fa-exclamation-triangle"></i> 
            ${
              order.acceptedSupplierId
                ? "This order is assigned to another supplier"
                : "This order is not assigned to any supplier"
            }
        </p>
    </div>`;
        } else if (type === "rejected") {
          if (order.isAssignedToSomeoneElse) {
            assignmentStatusHtml = `
        <div class="detail-group">
            <h4><i class="fas fa-exclamation-triangle"></i> Assignment Status</h4>
            <p class="text-warning"><i class="fas fa-exclamation-triangle"></i> 
                This order was assigned to another supplier
            </p>
        </div>`;
          } else if (order.isAssignedToCurrentSupplier) {
            assignmentStatusHtml = `
        <div class="detail-group">
            <h4><i class="fas fa-check-circle"></i> Assignment Status</h4>
            <p class="text-success"><i class="fas fa-check-circle"></i> 
                This order was assigned to you
            </p>
        </div>`;
          } else if (order.isCurrentSupplier) {
            assignmentStatusHtml = `
        <div class="detail-group">
            <h4><i class="fas fa-info-circle"></i> Assignment Status</h4>
            <p class="text-info"><i class="fas fa-info-circle"></i> 
                You rejected this order
            </p>
        </div>`;
          }
        }

        document.getElementById("orderModalBody").innerHTML = `
  <div class="order-details">
      <div class="detail-group">
          <h4><i class="fas fa-info-circle"></i> Order Information</h4>
          <p><strong>Order ID:</strong> ${order.order_id}</p>
          <p><strong>Status:</strong> <span class="badge ${
            order.working_status === "Completed"
              ? "badge-success"
              : order.working_status === "Working"
              ? "badge-primary"
              : "badge-warning"
          }">${order.working_status}</span></p>
          <p><strong>Approval Status:</strong> <span class="badge badge-success">${
            order.isApproved
          }</span></p>
      </div>
      
      ${assignmentStatusHtml}
      
      <div class="detail-group">
          <h4><i class="fas fa-cog"></i> Part Details</h4>
          <p><strong>Part Name:</strong> ${order.Part_Name}</p>
          <p><strong>Category:</strong> ${order.category}</p>
          <p><strong>Description:</strong> ${order.desc}</p>
          <p><strong>Quantity:</strong> ${order.tv}</p>
          <p><strong>Price:</strong> ${order.pr}</p>
      </div>
      
      <div class="detail-group">
          <h4><i class="fas fa-user"></i> Customer Information</h4>
          <p><strong>Name:</strong> ${order.cname}</p>
          <p><strong>Email:</strong> ${order.email}</p>
      </div>
      
      ${
        type === "rejected"
          ? `
      <div class="detail-group">
          <h4><i class="fas fa-times-circle"></i> Rejection Details</h4>
          <p class="text-danger"><i class="fas fa-exclamation-circle"></i> 
              ${
                order.isCurrentSupplier
                  ? "You rejected"
                  : "This order was rejected"
              }
          </p>
      </div>`
          : ""
      }
  </div>
`;

        orderModal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function showNotFoundMessage(type) {
        document.getElementById("orderModalBody").innerHTML = `
  <div class="no-data">Order details not found in ${type} orders.</div>
`;
        orderModal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      async function updateOrderStatus(orderId, supplierId, status) {
        if (isNaN(supplierId)) {
          console.error("Invalid supplier ID format");
          return;
        }

        const confirmMessage =
          status === "Accepted"
            ? "Are you sure you want to accept this order?"
            : "Are you sure you want to reject this order?";

        if (!confirm(confirmMessage)) {
          return;
        }

        try {
          const response = await fetch(
            "https://backend-api-hu8l.onrender.com/api/suppliers/orders/respond",
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                order_id: orderId,
                supplierId: Number(supplierId),
                status: status,
              }),
            }
          );

          if (!response.ok) throw new Error("Server error");

          alert("Order updated successfully!");
          location.reload();
        } catch (error) {
          console.error("Error updating order:", error);
          alert("Failed to update order.");
        }
      }

      function displayOrderStats(orders, supplier) {
        const statsContainer = document.getElementById("orderStats");

        // Filter orders based on different statuses
        const approvedOrders = orders.filter(
          (order) => order.isApproved === "Approved"
        );

        // Pending orders (approved but not responded to by this supplier)
        const pendingOrders = approvedOrders.filter(
          (order) =>
            !order.supplierResponses ||
            !order.supplierResponses.some(
              (response) => response.supplier_Id === supplier.supplierId
            )
        );

        // Accepted orders by this supplier
        const acceptedOrders = approvedOrders.filter(
          (order) =>
            order.supplierResponses &&
            order.supplierResponses.some(
              (response) =>
                response.supplier_Id === supplier.supplierId &&
                response.status === "Accepted"
            )
        );

        // Rejected orders by this supplier
        const rejectedOrders = approvedOrders.filter(
          (order) =>
            order.supplierResponses &&
            order.supplierResponses.some(
              (response) =>
                response.supplier_Id === supplier.supplierId &&
                response.status === "Rejected"
            )
        );

        // Orders assigned to this supplier
        const assignedOrders = approvedOrders.filter(
          (order) =>
            order.isSupplierAccepted &&
            order.acceptedSupplier?.supplier_Id === supplier.supplierId
        );

        // Create the stats HTML
        statsContainer.innerHTML = `
<div class="info-item">
  <h3>Total Approved Orders</h3>
  <p>${approvedOrders.length}</p>
</div>
<div class="info-item">
  <h3>Pending Your Response</h3>
  <p>${pendingOrders.length}</p>
</div>
<div class="info-item">
  <h3>Your Accepted Orders</h3>
  <p>${acceptedOrders.length}</p>
</div>
<div class="info-item">
  <h3>Your Rejected Orders</h3>
  <p>${rejectedOrders.length}</p>
</div>
<div class="info-item">
  <h3>Assigned to You</h3>
  <p>${assignedOrders.length}</p>
</div>
<div class="info-item">
  <h3>Completion Rate</h3>
  <p>${
    assignedOrders.length > 0
      ? Math.round(
          (assignedOrders.filter((o) => o.working_status === "Completed")
            .length /
            assignedOrders.length) *
            100
        ) + "%"
      : "N/A"
  }</p>
</div>`;
      }

      document.getElementById("logout").addEventListener("click", () => {
        sessionStorage.clear();
        window.location.href = "login.html";
      });
    </script>
  </body>
</html>
